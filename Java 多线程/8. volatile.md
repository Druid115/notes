## volatile

在 Java 中，volatile 关键字主要有以下两个功能：

1. 保证变量的内存可见性。
2. 禁止 volatile 变量与普通变量重排序。



### 内存可见性

当一个线程对 volatile 变量进行写操作时，JMM 会立即把该线程本地内存中该变量的值刷新到主内存；当⼀个线程对 volatile 变量进行读操作时，**JMM 会立即把该线程本地内存置为无效**，从主内存中读取共享变量的值。



### 禁止重排序

JSR-133 之前允许 volatile 变量与普通变量重排序，volatile 的写 - 读就不能与锁的释放 - 获取具有相同的内存语义。为了提供⼀种比锁更轻量级的线程间的通信机制，JVM 使用内存屏障限制了这种重排序。